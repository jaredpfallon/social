<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Social Coverage Seating Chart</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --ring: 0 0 0 3px rgba(59,130,246,0.4) inset; }
    html, body { height: 100%; }
    body { font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; }
    .card { box-shadow: 0 10px 25px rgba(0,0,0,0.08); }
    .editable:focus { outline: none; box-shadow: var(--ring); border-radius: 0.375rem; }
    .pill { @apply text-xs font-medium rounded-full px-2 py-0.5 bg-gray-100; }
  </style>
</head>
<body class="min-h-full bg-gradient-to-b from-gray-50 to-white text-gray-900">
  <header class="sticky top-0 z-20 backdrop-blur supports-[backdrop-filter]:bg-white/70 bg-white/90 border-b">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-2xl bg-black text-white grid place-items-center text-sm font-bold">DW</div>
        <h1 class="text-xl sm:text-2xl font-semibold">Social Coverage Seating Chart</h1>
      </div>
      <div class="flex flex-wrap gap-2">
        <button id="addRowBtn" class="px-3 py-2 rounded-xl bg-black text-white text-sm font-semibold">Add Talent</button>
        <button id="saveBtn" class="px-3 py-2 rounded-xl bg-gray-900/80 text-white text-sm font-semibold">Save</button>
        <button id="exportJsonBtn" class="px-3 py-2 rounded-xl bg-gray-100 text-sm font-semibold">Export JSON</button>
        <button id="exportCsvBtn" class="px-3 py-2 rounded-xl bg-gray-100 text-sm font-semibold">Export CSV</button>
        <label class="px-3 py-2 rounded-xl bg-gray-100 text-sm font-semibold cursor-pointer">
          Import JSON<input id="importJson" type="file" accept="application/json" class="hidden" />
        </label>
        <button id="copyMdBtn" class="px-3 py-2 rounded-xl bg-gray-100 text-sm font-semibold">Copy Markdown</button>
        <button id="resetBtn" class="px-3 py-2 rounded-xl bg-rose-50 text-rose-600 text-sm font-semibold">Load Defaults</button>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <section class="mb-6">
      <p class="text-sm text-gray-600">Edit any cell, the page saves to your browser. Export to JSON or CSV and commit to GitHub when ready. Use Add Talent to extend the list. You can also import a JSON that was exported here.</p>
    </section>

    <div class="overflow-x-auto card rounded-2xl bg-white">
      <table id="grid" class="w-full text-sm">
        <thead class="bg-gray-50 text-gray-700">
          <tr>
            <th class="px-4 py-3 text-left font-semibold">Talent or Show</th>
            <th class="px-4 py-3 text-left font-semibold">Content Creator Lead</th>
            <th class="px-4 py-3 text-left font-semibold">Content Creator</th>
            <th class="px-4 py-3 text-left font-semibold">Social Media Platform Specialist</th>
            <th class="px-4 py-3 text-left font-semibold">YouTube Thumbnail Creator</th>
            <th class="px-4 py-3 text-left font-semibold">Breakouts Required per Day</th>
            <th class="px-4 py-3 text-left font-semibold">Additional Optional</th>
            <th class="px-4 py-3 text-left font-semibold">Actions</th>
          </tr>
        </thead>
        <tbody id="tbody" class="divide-y">
        </tbody>
      </table>
    </div>
  </main>

  <footer class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-10 pt-6 text-xs text-gray-500">
    <p>Tip. Press Tab to jump across cells. Press Enter to add a new line inside a cell. Use Export to save. Use Load Defaults to restore this starter set.</p>
  </footer>

  <template id="row-template">
    <tr class="hover:bg-gray-50">
      <td class="align-top">
        <div contenteditable="true" class="editable px-4 py-3" data-key="talent"></div>
      </td>
      <td class="align-top">
        <div contenteditable="true" class="editable px-4 py-3" data-key="lead"></div>
      </td>
      <td class="align-top">
        <div contenteditable="true" class="editable px-4 py-3" data-key="creator"></div>
      </td>
      <td class="align-top">
        <div contenteditable="true" class="editable px-4 py-3" data-key="specialist"></div>
      </td>
      <td class="align-top">
        <div contenteditable="true" class="editable px-4 py-3" data-key="thumb"></div>
      </td>
      <td class="align-top">
        <div contenteditable="true" class="editable px-4 py-3" data-key="breakouts"></div>
      </td>
      <td class="align-top">
        <div contenteditable="true" class="editable px-4 py-3" data-key="notes"></div>
      </td>
      <td class="align-top w-[110px]">
        <div class="px-4 py-2 flex gap-2">
          <button class="px-2 py-1 text-xs rounded-lg bg-emerald-50 text-emerald-700 font-semibold" data-action="duplicate">Duplicate</button>
          <button class="px-2 py-1 text-xs rounded-lg bg-rose-50 text-rose-700 font-semibold" data-action="remove">Remove</button>
        </div>
      </td>
    </tr>
  </template>

  <script>
    const DEFAULT_ROWS = [
      { talent: "Daily Wire", lead: "Lucy", creator: "Allen", specialist: "Allen", thumb: "N A", breakouts: "", notes: "" },
      { talent: "Ben Shapiro", lead: "Jack", creator: "TBD", specialist: "TBD", thumb: "Grace", breakouts: "2", notes: "" },
      { talent: "Michael Knowles", lead: "Olivia", creator: "N A", specialist: "Madison", thumb: "Grace or Herzol", breakouts: "TBD", notes: "" },
      { talent: "Jordan Peterson", lead: "Luke Lockhart", creator: "N A", specialist: "Jonathan", thumb: "", breakouts: "", notes: "" },
      { talent: "Morning Wire", lead: "Braden", creator: "N A", specialist: "Jonathan", thumb: "Grace or Herbal", breakouts: "", notes: "" },
      { talent: "Andrew Klavan", lead: "Jonathan", creator: "", specialist: "Jonathan", thumb: "Grace or Herzol", breakouts: "", notes: "" },
      { talent: "Matt Walsh", lead: "Kaleb", creator: "N A", specialist: "Hugh", thumb: "Shorthand or Herzol", breakouts: "1 or 2", notes: "" },
      { talent: "Matt Fradd", lead: "Luke", creator: "TBD", specialist: "TBD", thumb: "TBD", breakouts: "TBD", notes: "" },
      { talent: "Reagan Conrad", lead: "Post Production Internal", creator: "", specialist: "Hugh Gaffney", thumb: "Grace", breakouts: "1", notes: "" },
      { talent: "Isabel Brown", lead: "Shorthand Studios", creator: "Shorthand Studios", specialist: "Shorthand Studios", thumb: "Shorthand Studios", breakouts: "1", notes: "" },
      { talent: "Craine and Co", lead: "Shorthand Studios", creator: "N A", specialist: "Hugh Gaffney", thumb: "TBD", breakouts: "TBD", notes: "" },
    ];

    const STORAGE_KEY = "dw_social_seating_v1";

    const $tbody = document.getElementById("tbody");
    const $rowTpl = document.getElementById("row-template");

    function loadData() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return DEFAULT_ROWS;
      try { return JSON.parse(raw); } catch { return DEFAULT_ROWS; }
    }

    function saveData(rows) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(rows));
    }

    function getRowsFromDOM() {
      return Array.from($tbody.querySelectorAll("tr")).map(tr => {
        const obj = {};
        tr.querySelectorAll(".editable").forEach(cell => {
          obj[cell.dataset.key] = cell.innerText.trim();
        });
        return obj;
      });
    }

    function render(rows) {
      $tbody.innerHTML = "";
      rows.forEach(addRowToDOM);
    }

    function addRowToDOM(row = {talent:"", lead:"", creator:"", specialist:"", thumb:"", breakouts:"", notes:""}) {
      const node = $rowTpl.content.cloneNode(true);
      node.querySelectorAll(".editable").forEach(el => {
        const key = el.dataset.key;
        el.textContent = row[key] || "";
        el.addEventListener("input", debounce(() => saveData(getRowsFromDOM()), 300));
      });
      const tr = node.querySelector("tr");
      tr.querySelector('[data-action="remove"]').addEventListener('click', () => {
        tr.remove();
        saveData(getRowsFromDOM());
      });
      tr.querySelector('[data-action="duplicate"]').addEventListener('click', () => {
        const copy = getRowsFromDOM()[Array.from($tbody.children).indexOf(tr)];
        addRowToDOM(copy);
        saveData(getRowsFromDOM());
      });
      $tbody.appendChild(node);
    }

    function exportJSON() {
      const data = getRowsFromDOM();
      const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      download(url, 'social_coverage.json');
    }

    function exportCSV() {
      const header = ["Talent or Show","Content Creator Lead","Content Creator","Social Media Platform Specialist","YouTube Thumbnail Creator","Breakouts Required per Day","Additional Optional"];
      const rows = getRowsFromDOM();
      const csv = [header.join(","), ...rows.map(r => [r.talent, r.lead, r.creator, r.specialist, r.thumb, r.breakouts, r.notes].map(s => '"' + (s || '').replaceAll('"','""') + '"').join(","))].join("\n");
      const blob = new Blob([csv], {type: 'text/csv'});
      const url = URL.createObjectURL(blob);
      download(url, 'social_coverage.csv');
    }

    function copyMarkdown() {
      const rows = getRowsFromDOM();
      const head = "| Talent or Show | Content Creator Lead | Content Creator | Social Media Platform Specialist | YouTube Thumbnail Creator | Breakouts per Day | Additional Optional |\n|---|---|---|---|---|---|---|";
      const body = rows.map(r => `| ${r.talent} | ${r.lead} | ${r.creator} | ${r.specialist} | ${r.thumb} | ${r.breakouts} | ${r.notes} |`).join("\n");
      navigator.clipboard.writeText([head, body].join("\n")).then(() => {
        toast("Markdown copied");
      });
    }

    function importJSON(file) {
      const reader = new FileReader();
      reader.onload = () => {
        try {
          const data = JSON.parse(reader.result);
          if (!Array.isArray(data)) throw new Error("Invalid format");
          render(data);
          saveData(data);
          toast("Imported");
        } catch {
          toast("Import failed");
        }
      };
      reader.readAsText(file);
    }

    function download(url, name) {
      const a = document.createElement('a');
      a.href = url; a.download = name; a.click();
      setTimeout(() => URL.revokeObjectURL(url), 1500);
    }

    function debounce(fn, wait){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), wait); } }

    function toast(msg) {
      const el = document.createElement('div');
      el.textContent = msg;
      el.className = 'fixed bottom-4 right-4 bg-black text-white text-sm px-3 py-2 rounded-lg shadow-lg';
      document.body.appendChild(el);
      setTimeout(()=> el.remove(), 1800);
    }

    // Wire up controls
    document.getElementById('addRowBtn').addEventListener('click', () => {
      addRowToDOM(); saveData(getRowsFromDOM());
    });
    document.getElementById('saveBtn').addEventListener('click', () => {
      saveData(getRowsFromDOM()); toast('Saved');
    });
    document.getElementById('exportJsonBtn').addEventListener('click', exportJSON);
    document.getElementById('exportCsvBtn').addEventListener('click', exportCSV);
    document.getElementById('copyMdBtn').addEventListener('click', copyMarkdown);
    document.getElementById('resetBtn').addEventListener('click', () => { render(DEFAULT_ROWS); saveData(DEFAULT_ROWS); toast('Defaults loaded'); });
    document.getElementById('importJson').addEventListener('change', e => { const f = e.target.files[0]; if (f) importJSON(f); e.target.value = ''; });

    // Initialize
    render(loadData());
  </script>
</body>
</html>
